!function(){function e(t,r,i){function n(s,a){if(!r[s]){if(!t[s]){var o="function"==typeof require&&require;if(!a&&o)return o(s,!0);if(l)return l(s,!0);var u=new Error("Cannot find module '"+s+"'");throw u.code="MODULE_NOT_FOUND",u}var f=r[s]={exports:{}};t[s][0].call(f.exports,function(e){var r=t[s][1][e];return n(r||e)},f,f.exports,e,t,r,i)}return r[s].exports}for(var l="function"==typeof require&&require,s=0;s<i.length;s++)n(i[s]);return n}return e}()({1:[function(e,t,r){(function(i){"use strict";function n(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(r,"__esModule",{value:!0}),r.WebCLGL=void 0;var l=function(){function e(e,t){for(var r=0;r<t.length;r++){var i=t[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,r,i){return r&&e(t.prototype,r),i&&e(t,i),t}}(),s=e("./WebCLGLBuffer.class"),a=e("./WebCLGLKernel.class"),o=e("./WebCLGLVertexFragmentProgram.class"),u=e("./WebCLGLUtils.class"),f=r.WebCLGL=function(){function e(t){var r=this;n(this,e),this.utils=new u.WebCLGLUtils,this._gl=null,this.e=null,void 0===t||null===t?(this.e=document.createElement("canvas"),this.e.width=32,this.e.height=32,this._gl=u.WebCLGLUtils.getWebGLContextFromCanvas(this.e,{antialias:!1})):this._gl=t;var i=this._gl.getShaderPrecisionFormat(this._gl.FRAGMENT_SHADER,this._gl.HIGH_FLOAT);this._precision=0!==i.precision?"precision highp float;\n\nprecision highp int;\n\n":"precision lowp float;\n\nprecision lowp int;\n\n",this.version=this._gl instanceof WebGL2RenderingContext?"#version 300 es \n ":"",this._arrExt=this._gl instanceof WebGL2RenderingContext?{EXT_color_buffer_float:null}:{OES_texture_float:null,OES_texture_float_linear:null,OES_element_index_uint:null,WEBGL_draw_buffers:null};for(var l in this._arrExt)this._arrExt[l]=this._gl.getExtension(l),null==this._arrExt[l]?console.error("extension "+l+" not available"):console.log("using extension "+l);this.extDrawBuff=this._gl instanceof WebGL2RenderingContext?"":" #extension GL_EXT_draw_buffers : require\n",this._maxDrawBuffers=8,this._currentTextureUnit=0,this._bufferWidth=0;var s=this.utils.loadQuad(void 0,1,1);this.vertexBuffer_QUAD=this._gl.createBuffer(),this._gl.bindBuffer(this._gl.ARRAY_BUFFER,this.vertexBuffer_QUAD),this._gl.bufferData(this._gl.ARRAY_BUFFER,new Float32Array(s.vertexArray),this._gl.STATIC_DRAW),this.indexBuffer_QUAD=this._gl.createBuffer(),this._gl.bindBuffer(this._gl.ELEMENT_ARRAY_BUFFER,this.indexBuffer_QUAD),this._gl.bufferData(this._gl.ELEMENT_ARRAY_BUFFER,new Uint16Array(s.indexArray),this._gl.STATIC_DRAW),this.arrayCopyTex=[];var a=this._gl instanceof WebGL2RenderingContext==!0?"in":"attribute",o=this._gl instanceof WebGL2RenderingContext==!0?"out":"varying",f=this._gl instanceof WebGL2RenderingContext==!0?"in":"varying",h=this._gl instanceof WebGL2RenderingContext?this._gl.RGBA32F:this._gl.RGBA,_=this.version+this._precision+a+" vec3 aVertexPosition;\n"+o+" vec2 vCoord;\nvoid main(void) {\ngl_Position = vec4(aVertexPosition, 1.0);\nvCoord = aVertexPosition.xy*0.5+0.5;\n}\n",g=this.version+this._precision+"uniform sampler2D sampler_buffer;\n"+f+" vec2 vCoord;\n"+(this._gl instanceof WebGL2RenderingContext?"out vec4 fragmentColor;":"")+"void main(void) {\n"+(this._gl instanceof WebGL2RenderingContext?"fragmentColor = texture(sampler_buffer, vCoord);":"gl_FragColor = texture2D(sampler_buffer, vCoord);")+"}\n";this.shader_readpixels=this._gl.createProgram(),this.utils.createShader(this._gl,"CLGLREADPIXELS",_,g,this.shader_readpixels),this.attr_VertexPos=this._gl.getAttribLocation(this.shader_readpixels,"aVertexPosition"),this.sampler_buffer=this._gl.getUniformLocation(this.shader_readpixels,"sampler_buffer");_=this.version+this._precision+a+" vec3 aVertexPosition;\n"+o+" vec2 vCoord;\nvoid main(void) {\ngl_Position = vec4(aVertexPosition, 1.0);\nvCoord = aVertexPosition.xy*0.5+0.5;\n}",g=this.version+this.extDrawBuff+this._precision+"uniform sampler2D uArrayCT["+this._maxDrawBuffers+"];\n"+f+" vec2 vCoord;\n"+(this._gl instanceof WebGL2RenderingContext?function(){for(var e="",t=0,i=r._maxDrawBuffers;t<i;t++)e+="layout(location = "+t+") out vec4 outCol"+t+";\n";return e}():"")+"void main(void) {\n"+function(){for(var e="",t=0,i=r._maxDrawBuffers;t<i;t++)e+=r._gl instanceof WebGL2RenderingContext?"outCol"+t+" = texture(uArrayCT["+t+"], vCoord);\n":"gl_FragData["+t+"] = texture(uArrayCT["+t+"], vCoord);\n";return e}()+"}",this.shader_copyTexture=this._gl.createProgram(),this.utils.createShader(this._gl,"CLGLCOPYTEXTURE",_,g,this.shader_copyTexture),this.attr_copyTexture_pos=this._gl.getAttribLocation(this.shader_copyTexture,"aVertexPosition");for(var c=0,d=this._maxDrawBuffers;c<d;c++)this.arrayCopyTex[c]=this._gl.getUniformLocation(this.shader_copyTexture,"uArrayCT["+c+"]");this.textureDataAux=this._gl.createTexture(),this._gl.bindTexture(this._gl.TEXTURE_2D,this.textureDataAux),this._gl.texImage2D(this._gl.TEXTURE_2D,0,h,2,2,0,this._gl.RGBA,this._gl.FLOAT,new Float32Array([1,0,0,1,0,1,0,1,0,0,1,1,1,1,1,1])),this._gl.texParameteri(this._gl.TEXTURE_2D,this._gl.TEXTURE_MAG_FILTER,this._gl.NEAREST),this._gl.texParameteri(this._gl.TEXTURE_2D,this._gl.TEXTURE_MIN_FILTER,this._gl.NEAREST),this._gl.texParameteri(this._gl.TEXTURE_2D,this._gl.TEXTURE_WRAP_S,this._gl.CLAMP_TO_EDGE),this._gl.texParameteri(this._gl.TEXTURE_2D,this._gl.TEXTURE_WRAP_T,this._gl.CLAMP_TO_EDGE),this._gl.bindTexture(this._gl.TEXTURE_2D,null)}return l(e,[{key:"getContext",value:function(){return this._gl}},{key:"getMaxDrawBuffers",value:function(){return this._maxDrawBuffers}},{key:"checkFramebufferStatus",value:function(){var e=this._gl.checkFramebufferStatus(this._gl.FRAMEBUFFER),t={};return t[this._gl.FRAMEBUFFER_COMPLETE]=!0,t[this._gl.FRAMEBUFFER_INCOMPLETE_ATTACHMENT]="FRAMEBUFFER_INCOMPLETE_ATTACHMENT: The attachment types are mismatched or not all framebuffer attachment points are framebuffer attachment complete",t[this._gl.FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT]="FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT: There is no attachment",t[this._gl.FRAMEBUFFER_INCOMPLETE_DIMENSIONS]="FRAMEBUFFER_INCOMPLETE_DIMENSIONS: Height and width of the attachment are not the same",t[this._gl.FRAMEBUFFER_UNSUPPORTED]="FRAMEBUFFER_UNSUPPORTED: The format of the attachment is not supported or if depth and stencil attachments are not the same renderbuffer",!0===t[e]&&null!==t[e]||(console.log(t[e]),!1)}},{key:"copy",value:function(e,t){if(void 0!==t&&null!==t)if(void 0!==t[0]&&null!==t[0]){this._gl.viewport(0,0,t[0].W,t[0].H),this._gl.bindFramebuffer(this._gl.FRAMEBUFFER,t[0].fBuffer);var r=[];if(this._gl instanceof WebGL2RenderingContext){for(var i=0,n=t.length;i<n;i++)void 0!==t[i]&&null!==t[i]?(this._gl.framebufferTexture2D(this._gl.FRAMEBUFFER,this._gl["COLOR_ATTACHMENT"+i],this._gl.TEXTURE_2D,t[i].textureData,0),r[i]=this._gl["COLOR_ATTACHMENT"+i]):r[i]=this._gl.NONE;this._gl.drawBuffers(r)}else{for(var l=0,s=t.length;l<s;l++)void 0!==t[l]&&null!==t[l]?(this._gl.framebufferTexture2D(this._gl.FRAMEBUFFER,this._arrExt.WEBGL_draw_buffers["COLOR_ATTACHMENT"+l+"_WEBGL"],this._gl.TEXTURE_2D,t[l].textureData,0),r[l]=this._arrExt.WEBGL_draw_buffers["COLOR_ATTACHMENT"+l+"_WEBGL"]):r[l]=this._gl.NONE;this._arrExt.WEBGL_draw_buffers.drawBuffersWEBGL(r)}if(!0===this.checkFramebufferStatus()){this._gl.useProgram(this.shader_copyTexture);for(var a=0,o=t.length;a<o;a++)this._gl.activeTexture(this._gl["TEXTURE"+a]),void 0!==t[a]&&null!==t[a]?this._gl.bindTexture(this._gl.TEXTURE_2D,t[a].textureDataTemp):this._gl.bindTexture(this._gl.TEXTURE_2D,this.textureDataAux),this._gl.uniform1i(this.arrayCopyTex[a],a);this.copyNow(t)}}else this._gl.bindFramebuffer(this._gl.FRAMEBUFFER,null);else this._gl.bindFramebuffer(this._gl.FRAMEBUFFER,null)}},{key:"copyNow",value:function(e){this._gl.enableVertexAttribArray(this.attr_copyTexture_pos),this._gl.bindBuffer(this._gl.ARRAY_BUFFER,this.vertexBuffer_QUAD),this._gl.vertexAttribPointer(this.attr_copyTexture_pos,3,this._gl.FLOAT,!1,0,0),this._gl.bindBuffer(this._gl.ELEMENT_ARRAY_BUFFER,this.indexBuffer_QUAD),this._gl.drawElements(this._gl.TRIANGLES,6,this._gl.UNSIGNED_SHORT,0)}},{key:"createBuffer",value:function(e,t,r){return new s.WebCLGLBuffer(this._gl,e,t,r)}},{key:"createKernel",value:function(e,t){return new a.WebCLGLKernel(this._gl,e,t)}},{key:"createVertexFragmentProgram",value:function(e,t,r,i){return new o.WebCLGLVertexFragmentProgram(this._gl,e,t,r,i)}},{key:"fillBuffer",value:function(e,t,r){if(this._gl.bindFramebuffer(this._gl.FRAMEBUFFER,r),this._gl instanceof WebGL2RenderingContext){this._gl.framebufferTexture2D(this._gl.FRAMEBUFFER,this._gl.COLOR_ATTACHMENT0,this._gl.TEXTURE_2D,e,0);var i=[this._gl.COLOR_ATTACHMENT0];this._gl.drawBuffers(i)}else{this._gl.framebufferTexture2D(this._gl.FRAMEBUFFER,this._arrExt.WEBGL_draw_buffers.COLOR_ATTACHMENT0_WEBGL,this._gl.TEXTURE_2D,e,0);var n=[this._arrExt.WEBGL_draw_buffers.COLOR_ATTACHMENT0_WEBGL];this._arrExt.WEBGL_draw_buffers.drawBuffersWEBGL(n)}void 0!==t&&null!==t&&this._gl.clearColor(t[0],t[1],t[2],t[3]),this._gl.clear(this._gl.COLOR_BUFFER_BIT)}},{key:"bindAttributeValue",value:function(e,t){void 0!==t&&null!==t?"float4_fromAttr"===e.type?(this._gl.enableVertexAttribArray(e.location[0]),this._gl.bindBuffer(this._gl.ARRAY_BUFFER,t.vertexData0),this._gl.vertexAttribPointer(e.location[0],4,this._gl.FLOAT,!1,0,0)):"float_fromAttr"===e.type&&(this._gl.enableVertexAttribArray(e.location[0]),this._gl.bindBuffer(this._gl.ARRAY_BUFFER,t.vertexData0),this._gl.vertexAttribPointer(e.location[0],1,this._gl.FLOAT,!1,0,0)):this._gl.disableVertexAttribArray(e.location[0])}},{key:"bindSamplerValue",value:function(e,t,r){this._currentTextureUnit<16?this._gl.activeTexture(this._gl["TEXTURE"+this._currentTextureUnit]):this._gl.activeTexture(this._gl.TEXTURE16),void 0!==r&&null!==r?(this._gl.bindTexture(this._gl.TEXTURE_2D,r.textureData),0===this._bufferWidth&&(this._bufferWidth=r.W,this._gl.uniform1f(e,this._bufferWidth))):this._gl.bindTexture(this._gl.TEXTURE_2D,this.textureDataAux),this._gl.uniform1i(t.location[0],this._currentTextureUnit),this._currentTextureUnit++}},{key:"bindUniformValue",value:function(e,t){void 0!==t&&null!==t&&("float"===e.type?t.constructor===Array?this._gl.uniform1fv(e.location[0],t):this._gl.uniform1f(e.location[0],t):"float4"===e.type?this._gl.uniform4f(e.location[0],t[0],t[1],t[2],t[3]):"mat4"===e.type&&this._gl.uniformMatrix4fv(e.location[0],!1,t))}},{key:"bindValue",value:function(e,t,r){switch(t.expectedMode){case"ATTRIBUTE":this.bindAttributeValue(t,r);break;case"SAMPLER":this.bindSamplerValue(e.uBufferWidth,t,r);break;case"UNIFORM":this.bindUniformValue(t,r)}}},{key:"bindFB",value:function(e,t){if(void 0!==e&&null!==e){if(void 0!==e[0]&&null!==e[0]){this._gl.viewport(0,0,e[0].W,e[0].H),this._gl.bindFramebuffer(this._gl.FRAMEBUFFER,!0===t?e[0].fBufferTemp:e[0].fBuffer);for(var r=[],i=0,n=e.length;i<n;i++)if(void 0!==e[i]&&null!==e[i]){var l=!0===t?e[i].textureDataTemp:e[i].textureData;this._gl instanceof WebGL2RenderingContext?(this._gl.framebufferTexture2D(this._gl.FRAMEBUFFER,this._gl["COLOR_ATTACHMENT"+i],this._gl.TEXTURE_2D,l,0),r[i]=this._gl["COLOR_ATTACHMENT"+i]):(this._gl.framebufferTexture2D(this._gl.FRAMEBUFFER,this._arrExt.WEBGL_draw_buffers["COLOR_ATTACHMENT"+i+"_WEBGL"],this._gl.TEXTURE_2D,l,0),r[i]=this._arrExt.WEBGL_draw_buffers["COLOR_ATTACHMENT"+i+"_WEBGL"])}else r[i]=this._gl.NONE;return this._gl instanceof WebGL2RenderingContext?this._gl.drawBuffers(r):this._arrExt.WEBGL_draw_buffers.drawBuffersWEBGL(r),!0}return this._gl.bindFramebuffer(this._gl.FRAMEBUFFER,null),!0}return this._gl.bindFramebuffer(this._gl.FRAMEBUFFER,null),!0}},{key:"enqueueNDRangeKernel",value:function(e,t,r,i){if(this._bufferWidth=0,this._gl.useProgram(e.kernel),!0===this.bindFB(t,r)){this._currentTextureUnit=0;for(var n in e.in_values)this.bindValue(e,e.in_values[n],i[n]);this._gl.enableVertexAttribArray(e.attr_VertexPos),this._gl.bindBuffer(this._gl.ARRAY_BUFFER,this.vertexBuffer_QUAD),this._gl.vertexAttribPointer(e.attr_VertexPos,3,this._gl.FLOAT,!1,0,0),this._gl.bindBuffer(this._gl.ELEMENT_ARRAY_BUFFER,this.indexBuffer_QUAD),this._gl.drawElements(this._gl.TRIANGLES,6,this._gl.UNSIGNED_SHORT,0)}}},{key:"enqueueVertexFragmentProgram",value:function(e,t,r,i,n,l){this._bufferWidth=0,this._gl.useProgram(e.vertexFragmentProgram);var s=void 0!==r&&null!==r?r:4;if(!0===this.bindFB(i,n)&&void 0!==t&&null!==t){this._currentTextureUnit=0;for(var a in e.in_vertex_values)this.bindValue(e,e.in_vertex_values[a],l[a]);for(var o in e.in_fragment_values)this.bindValue(e,e.in_fragment_values[o],l[o]);"VERTEX_INDEX"===t.mode?(this._gl.bindBuffer(this._gl.ELEMENT_ARRAY_BUFFER,t.vertexData0),this._gl.drawElements(s,t.length,this._gl.UNSIGNED_SHORT,0)):this._gl.drawArrays(s,0,t.length)}}},{key:"readBuffer",value:function(e){if(void 0!==this.e&&null!==this.e&&(this.e.width=e.W,this.e.height=e.H),this._gl.useProgram(this.shader_readpixels),this._gl.viewport(0,0,e.W,e.H),this._gl.bindFramebuffer(this._gl.FRAMEBUFFER,e.fBufferTemp),this._gl instanceof WebGL2RenderingContext){this._gl.framebufferTexture2D(this._gl.FRAMEBUFFER,this._gl.COLOR_ATTACHMENT0,this._gl.TEXTURE_2D,e.textureDataTemp,0);var t=[this._gl.COLOR_ATTACHMENT0];this._gl.drawBuffers(t)}else{this._gl.framebufferTexture2D(this._gl.FRAMEBUFFER,this._arrExt.WEBGL_draw_buffers.COLOR_ATTACHMENT0_WEBGL,this._gl.TEXTURE_2D,e.textureDataTemp,0);var r=[this._arrExt.WEBGL_draw_buffers.COLOR_ATTACHMENT0_WEBGL];this._arrExt.WEBGL_draw_buffers.drawBuffersWEBGL(r)}if(this._gl.activeTexture(this._gl.TEXTURE0),this._gl.bindTexture(this._gl.TEXTURE_2D,e.textureData),this._gl.uniform1i(this.sampler_buffer,0),this._gl.enableVertexAttribArray(this.attr_VertexPos),this._gl.bindBuffer(this._gl.ARRAY_BUFFER,this.vertexBuffer_QUAD),this._gl.vertexAttribPointer(this.attr_VertexPos,3,e._supportFormat,!1,0,0),this._gl.bindBuffer(this._gl.ELEMENT_ARRAY_BUFFER,this.indexBuffer_QUAD),this._gl.drawElements(this._gl.TRIANGLES,6,this._gl.UNSIGNED_SHORT,0),void 0!==e.outArrayFloat&&null!==e.outArrayFloat||(e.outArrayFloat=new Float32Array(e.W*e.H*4)),this._gl.readPixels(0,0,e.W,e.H,this._gl.RGBA,this._gl.FLOAT,e.outArrayFloat),"FLOAT"===e.type){for(var i=new Float32Array(e.outArrayFloat.length/4),n=0,l=e.outArrayFloat.length/4;n<l;n++)i[n]=e.outArrayFloat[4*n];e.outArrayFloat=i}return e.outArrayFloat}}],[{key:"enqueueReadBuffer_WebGLTexture",value:function(e){return e.textureData}}]),e}();i.WebCLGL=f,t.exports.WebCLGL=f}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"./WebCLGLBuffer.class":2,"./WebCLGLKernel.class":4,"./WebCLGLUtils.class":5,"./WebCLGLVertexFragmentProgram.class":6}],2:[function(e,t,r){(function(e){"use strict";function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(r,"__esModule",{value:!0});var n=function(){function e(e,t){for(var r=0;r<t.length;r++){var i=t[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,r,i){return r&&e(t.prototype,r),i&&e(t,i),t}}(),l=r.WebCLGLBuffer=function(){function e(t,r,n,l){i(this,e),this._gl=t,this.type=void 0!==r||null!==r?r:"FLOAT",this._supportFormat=this._gl.FLOAT,this.linear=void 0===n&&null===n||n,this.mode=void 0!==l||null!==l?l:"SAMPLER",this.W=null,this.H=null,this.textureData=null,this.textureDataTemp=null,this.vertexData0=null,this.fBuffer=null,this.renderBuffer=null,this.fBufferTemp=null,this.renderBufferTemp=null,"SAMPLER"===this.mode&&(this.textureData=this._gl.createTexture(),this.textureDataTemp=this._gl.createTexture()),"SAMPLER"!==this.mode&&"ATTRIBUTE"!==this.mode&&"VERTEX_INDEX"!==this.mode||(this.vertexData0=this._gl.createBuffer())}return n(e,[{key:"createFramebufferAndRenderbuffer",value:function(){var e=function(){var e=this._gl.createRenderbuffer();this._gl.bindRenderbuffer(this._gl.RENDERBUFFER,e);var t=this._gl instanceof WebGL2RenderingContext?this._gl.DEPTH_COMPONENT32F:this._gl.DEPTH_COMPONENT16;return this._gl.renderbufferStorage(this._gl.RENDERBUFFER,t,this.W,this.H),this._gl.bindRenderbuffer(this._gl.RENDERBUFFER,null),e}.bind(this);null!=this.fBuffer&&(this._gl.deleteFramebuffer(this.fBuffer),this._gl.deleteFramebuffer(this.fBufferTemp),this._gl.deleteRenderbuffer(this.renderBuffer),this._gl.deleteRenderbuffer(this.renderBufferTemp)),this.fBuffer=this._gl.createFramebuffer(),this.renderBuffer=e(),this._gl.bindFramebuffer(this._gl.FRAMEBUFFER,this.fBuffer),this._gl.framebufferRenderbuffer(this._gl.FRAMEBUFFER,this._gl.DEPTH_ATTACHMENT,this._gl.RENDERBUFFER,this.renderBuffer),this.fBufferTemp=this._gl.createFramebuffer(),this.renderBufferTemp=e(),this._gl.bindFramebuffer(this._gl.FRAMEBUFFER,this.fBufferTemp),this._gl.framebufferRenderbuffer(this._gl.FRAMEBUFFER,this._gl.DEPTH_ATTACHMENT,this._gl.RENDERBUFFER,this.renderBufferTemp)}},{key:"writeWebGLTextureBuffer",value:function(e,t){var r=function(e,t){!1===t||void 0===t||null===t?this._gl.pixelStorei(this._gl.UNPACK_FLIP_Y_WEBGL,!1):this._gl.pixelStorei(this._gl.UNPACK_FLIP_Y_WEBGL,!0),this._gl.pixelStorei(this._gl.UNPACK_PREMULTIPLY_ALPHA_WEBGL,!1),this._gl.bindTexture(this._gl.TEXTURE_2D,e)}.bind(this),i=function(e){e instanceof HTMLImageElement?"FLOAT4"===this.type&&(this._gl instanceof WebGL2RenderingContext?this._gl.texImage2D(this._gl.TEXTURE_2D,0,this._gl.RGBA32F,e.width,e.height,0,this._gl.RGBA,this._supportFormat,e):this._gl.texImage2D(this._gl.TEXTURE_2D,0,this._gl.RGBA,this._gl.RGBA,this._supportFormat,e)):this._gl instanceof WebGL2RenderingContext?this._gl.texImage2D(this._gl.TEXTURE_2D,0,this._gl.RGBA32F,this.W,this.H,0,this._gl.RGBA,this._supportFormat,e):this._gl.texImage2D(this._gl.TEXTURE_2D,0,this._gl.RGBA,this.W,this.H,0,this._gl.RGBA,this._supportFormat,e)}.bind(this),n=function(){this._gl.texParameteri(this._gl.TEXTURE_2D,this._gl.TEXTURE_MAG_FILTER,this._gl.NEAREST),this._gl.texParameteri(this._gl.TEXTURE_2D,this._gl.TEXTURE_MIN_FILTER,this._gl.NEAREST),this._gl.texParameteri(this._gl.TEXTURE_2D,this._gl.TEXTURE_WRAP_S,this._gl.CLAMP_TO_EDGE),this._gl.texParameteri(this._gl.TEXTURE_2D,this._gl.TEXTURE_WRAP_T,this._gl.CLAMP_TO_EDGE)}.bind(this);e instanceof WebGLTexture?(this.textureData=e,this.textureDataTemp=e):(r(this.textureData,t),i(e),n(),r(this.textureDataTemp,t),i(e),n()),this._gl.bindTexture(this._gl.TEXTURE_2D,null)}},{key:"writeBuffer",value:function(e,t,r){var i=function(e){if(!(e instanceof HTMLImageElement))if(this.length.constructor===Array?(this.length=this.length[0]*this.length[1],this.W=this.length[0],this.H=this.length[1]):(this.W=Math.ceil(Math.sqrt(this.length)),this.H=this.W),"FLOAT4"===this.type){e=e instanceof Float32Array?e:new Float32Array(e);var t=this.W*this.H*4;if(e.length!==t){for(var r=new Float32Array(t),i=0;i<t;i++)r[i]=null!=e[i]?e[i]:0;e=r}}else if("FLOAT"===this.type){for(var n=this.W*this.H*4,l=new Float32Array(n),s=0,a=this.W*this.H;s<a;s++){var o=4*s;l[o]=null!=e[s]?e[s]:0,l[o+1]=0,l[o+2]=0,l[o+3]=0}e=l}return e}.bind(this);void 0===r||null===r?e instanceof HTMLImageElement?this.length=e.width*e.height:this.length="FLOAT4"===this.type?e.length/4:e.length:this.length=[r[0],r[1]],"SAMPLER"===this.mode&&this.writeWebGLTextureBuffer(i(e),t),console.log("[WebCLGLBuffer writeBuffer] mode: "+this.mode+", vl: "+this.length+", size("+this.W+" "+this.H+")\n"),"SAMPLER"!==this.mode&&"ATTRIBUTE"!==this.mode||(this._gl.bindBuffer(this._gl.ARRAY_BUFFER,this.vertexData0),this._gl.bufferData(this._gl.ARRAY_BUFFER,e instanceof Float32Array?e:new Float32Array(e),this._gl.STATIC_DRAW)),"VERTEX_INDEX"===this.mode&&(this._gl.bindBuffer(this._gl.ELEMENT_ARRAY_BUFFER,this.vertexData0),this._gl.bufferData(this._gl.ELEMENT_ARRAY_BUFFER,new Uint16Array(e),this._gl.STATIC_DRAW)),this.createFramebufferAndRenderbuffer()}},{key:"remove",value:function(){"SAMPLER"===this.mode&&(this._gl.deleteTexture(this.textureData),this._gl.deleteTexture(this.textureDataTemp)),"SAMPLER"!==this.mode&&"ATTRIBUTE"!==this.mode&&"VERTEX_INDEX"!==this.mode||this._gl.deleteBuffer(this.vertexData0),this._gl.deleteFramebuffer(this.fBuffer),this._gl.deleteFramebuffer(this.fBufferTemp),this._gl.deleteRenderbuffer(this.renderBuffer),this._gl.deleteRenderbuffer(this.renderBufferTemp)}}]),e}();e.WebCLGLBuffer=l,t.exports.WebCLGLBuffer=l}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],3:[function(e,t,r){(function(i){"use strict";function n(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function l(){var e=new u,t=null;return arguments[0]instanceof WebGLRenderingContext||arguments[0]instanceof WebGL2RenderingContext?(t=arguments[0],e.setCtx(t),e._webCLGL=new a.WebCLGL(t),e.iniG(arguments),e):arguments[0]instanceof HTMLCanvasElement?(t=o.WebCLGLUtils.getWebGLContextFromCanvas(arguments[0]),e.setCtx(t),e._webCLGL=new a.WebCLGL(t),e.iniG(arguments),e):(t=o.WebCLGLUtils.getWebGLContextFromCanvas(document.createElement("canvas"),{antialias:!1}),e.setCtx(t),e._webCLGL=new a.WebCLGL(t),e.ini(arguments))}Object.defineProperty(r,"__esModule",{value:!0}),r.WebCLGLFor=void 0;var s=function(){function e(e,t){for(var r=0;r<t.length;r++){var i=t[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,r,i){return r&&e(t.prototype,r),i&&e(t,i),t}}();r.gpufor=l;var a=e("./WebCLGL.class"),o=e("./WebCLGLUtils.class"),u=r.WebCLGLFor=function(){function e(t){n(this,e),this.kernels={},this.vertexFragmentPrograms={},this._args={},this._argsValues={},this.calledArgs={},this._webCLGL=null,this._gl=null}return s(e,[{key:"defineOutputTempModes",value:function(e,t){for(var r=[],i=0;i<e.length;i++)r[i]=null!=e[i]&&function(e,t){var r=!1;for(var i in t)if("indices"!==i){var n=i.split(" ");if(n.length>0&&n[1]===e){r=!0;break}}return r}(e[i],t);return r}},{key:"prepareReturnCode",value:function(e,t){var r=[],i=e.match(new RegExp(/return.*$/gm)),n=(i=i[0].replace("return ","")).match(new RegExp(/\[/gm));if(null!=n&&n.length>=1){i=i.split("[")[1].split("]")[0];for(var l="",s=0,a=0;a<i.length;a++)","===i[a]&&0===s?(r.push(l),l=""):l+=i[a],"("===i[a]&&s++,")"===i[a]&&s--;r.push(l)}else r.push(i.replace(/;$/gm,""));for(var o="",u=0;u<t.length;u++){var f=!1;for(var h in this._args)if("indices"!==h){var _=h.split(" ");if(_[1]===t[u]){var g=_[0].match(new RegExp("float4","gm"));o+=null!=g&&g.length>0?"out"+u+"_float4 = "+r[u]+";\n":"out"+u+"_float = "+r[u]+";\n",f=!0;break}}!1===f&&(o+="out"+u+"_float4 = "+r[u]+";\n")}return o}},{key:"addKernel",value:function(e){var t=e.config,r=t[0],i=t[1]instanceof Array?t[1]:[t[1]],n=t[2],l=t[3],s=this._webCLGL.createKernel(),a=[];for(var o in this._args){var u=o.split(" ")[1];if(void 0!==u&&null!==u){var f=(n+l).match(new RegExp(u.replace(/\[\d.*/,""),"gm"));"indices"!==o&&null!=f&&f.length>0&&(s.in_values[u]={},a.push(o.replace("*attr ","* ").replace(/\[\d.*/,"")))}}l="void main("+a.toString()+") {vec2 "+r+" = get_global_id();"+l.replace(/return.*$/gm,this.prepareReturnCode(l,i))+"}",s.name=e.name,s.viewSource=null!=e.viewSource&&e.viewSource,s.setKernelSource(l,n),s.output=i,s.outputTempModes=this.defineOutputTempModes(i,this._args),s.enabled=!0,s.drawMode=null!=e.drawMode?e.drawMode:4,s.depthTest=null==e.depthTest||e.depthTest,s.blend=null!=e.blend&&e.blend,s.blendEquation=null!=e.blendEquation?e.blendEquation:"FUNC_ADD",s.blendSrcMode=null!=e.blendSrcMode?e.blendSrcMode:"SRC_ALPHA",s.blendDstMode=null!=e.blendDstMode?e.blendDstMode:"ONE_MINUS_SRC_ALPHA",this.kernels[Object.keys(this.kernels).length.toString()]=s}},{key:"addGraphic",value:function(e){var t=e.config,r=[null],i=void 0,n=void 0,l=void 0,s=void 0;5===t.length?(r=t[0]instanceof Array?t[0]:[t[0]],i=t[1],n=t[2],l=t[3],s=t[4]):(i=t[0],n=t[1],l=t[2],s=t[3]);var a=this._webCLGL.createVertexFragmentProgram(),o=[],u=[];for(var f in this._args){var h=f.split(" ")[1];if(void 0!==h&&null!==h){var _=(i+n).match(new RegExp(h.replace(/\[\d.*/,""),"gm"));"indices"!==f&&null!=_&&_.length>0&&(a.in_vertex_values[h]={},o.push(f.replace(/\[\d.*/,"")))}}for(var g in this._args){var c=g.split(" ")[1];if(void 0!==c&&null!==c){var d=(l+s).match(new RegExp(c.replace(/\[\d.*/,""),"gm"));"indices"!==g&&null!=d&&d.length>0&&(a.in_fragment_values[c]={},u.push(g.replace(/\[\d.*/,"")))}}n="void main("+o.toString()+") {"+n+"}",s="void main("+u.toString()+") {"+s.replace(/return.*$/gm,this.prepareReturnCode(s,r))+"}",a.name=e.name,a.viewSource=null!=e.viewSource&&e.viewSource,a.setVertexSource(n,i),a.setFragmentSource(s,l),a.output=r,a.outputTempModes=this.defineOutputTempModes(r,this._args),a.enabled=!0,a.drawMode=null!=e.drawMode?e.drawMode:4,a.depthTest=null==e.depthTest||e.depthTest,a.blend=null==e.blend||e.blend,a.blendEquation=null!=e.blendEquation?e.blendEquation:"FUNC_ADD",a.blendSrcMode=null!=e.blendSrcMode?e.blendSrcMode:"SRC_ALPHA",a.blendDstMode=null!=e.blendDstMode?e.blendDstMode:"ONE_MINUS_SRC_ALPHA",this.vertexFragmentPrograms[Object.keys(this.vertexFragmentPrograms).length.toString()]=a}},{key:"checkArg",value:function(e,t,r){var i=[],n=!1,l=!1;for(var s in t)for(var a in t[s].in_values){t[s].in_values[a];if(a===e){i.push(t[s]);break}}for(var o in r){for(var u in r[o].in_vertex_values){r[o].in_vertex_values[u];if(u===e){n=!0;break}}for(var f in r[o].in_fragment_values){r[o].in_fragment_values[f];if(f===e){l=!0;break}}}return{usedInVertex:n,usedInFragment:l,kernelPr:i}}},{key:"fillArg",value:function(e,t){this._webCLGL.fillBuffer(this._argsValues[e].textureData,t,this._argsValues[e].fBuffer),this._webCLGL.fillBuffer(this._argsValues[e].textureDataTemp,t,this._argsValues[e].fBufferTemp)}},{key:"argIsNull",value:function(e){return void 0===this._argsValues[e]||null===this._argsValues[e]}},{key:"getArgBufferWidth",value:function(e){return this._argsValues[e].W}},{key:"getAllArgs",value:function(){return this._argsValues}},{key:"addArg",value:function(e){this._args[e]=null}},{key:"getGPUForArg",value:function(e,t){!1===this.calledArgs.hasOwnProperty(e)&&(this.calledArgs[e]=[]),-1===this.calledArgs[e].indexOf(t)&&this.calledArgs[e].push(t),!1===t.calledArgs.hasOwnProperty(e)&&(t.calledArgs[e]=[]),-1===t.calledArgs[e].indexOf(this)&&t.calledArgs[e].push(this);for(var r in t._args){var i=r.split(" ")[1];if(i===e){this._args[r]=t._args[r],this._argsValues[i]=t._argsValues[i];break}}}},{key:"setArg",value:function(e,t,r,i){if("indices"===e)this.setIndices(t);else for(var n in this._args){var l=n.split(" ")[1];if(void 0!==l&&l.replace(/\[\d.*/,"")===e){l!==e&&(e=l);var s=!1;if(null!=n.match(/\*/gm)){var a=this.checkArg(e,this.kernels,this.vertexFragmentPrograms),o="SAMPLER";!0===a.usedInVertex&&0===a.kernelPr.length&&!1===a.usedInFragment&&(o="ATTRIBUTE");var u=n.split("*")[0].toUpperCase();void 0!==i&&null!==i&&(u=i),void 0!==t&&null!==t?(console.log("[WebCLGLFor setArgBuffer] "+e+")\n"),(!1===this._argsValues.hasOwnProperty(e)||!0===this._argsValues.hasOwnProperty(e)&&null==this._argsValues[e])&&(this._argsValues[e]=this._webCLGL.createBuffer(u,!1,o),this._argsValues[e].argument=e,s=!0),this._argsValues[e].writeBuffer(t,!1,r)):(console.log("[WebCLGLFor setArgNull] "+e+")\n"),this._argsValues[e]=null)}else void 0!==t&&null!==t&&(console.log("[WebCLGLFor setArgUniform] "+e+" "+t+")\n"),this._argsValues[e]=t),s=!0;if(!0===s&&!0===this.calledArgs.hasOwnProperty(e))for(var f=0;f<this.calledArgs[e].length;f++)this.calledArgs[e][f]._argsValues[e]=this._argsValues[e];break}}return t}},{key:"readArg",value:function(e){return this._webCLGL.readBuffer(this._argsValues[e])}},{key:"setIndices",value:function(e){this.CLGL_bufferIndices=this._webCLGL.createBuffer("FLOAT",!1,"VERTEX_INDEX"),this.CLGL_bufferIndices.writeBuffer(e)}},{key:"getCtx",value:function(){return this._webCLGL.getContext()}},{key:"setCtx",value:function(e){this._gl=e}},{key:"getWebCLGL",value:function(){return this._webCLGL}},{key:"onPreProcessKernel",value:function(e,t){this.kernels[e].onpre=t}},{key:"onPostProcessKernel",value:function(e,t){this.kernels[e].onpost=t}},{key:"enableKernel",value:function(e){this.kernels["0"|e.toString()].enabled=!0}},{key:"disableKernel",value:function(e){this.kernels["0"|e.toString()].enabled=!1}},{key:"getKernel",value:function(e){for(var t in this.kernels)if(t===e)return this.kernels[t];return null}},{key:"getAllKernels",value:function(){return this.kernels}},{key:"onPreProcessGraphic",value:function(e,t){this.vertexFragmentPrograms[e].onpre=t}},{key:"onPostProcessGraphic",value:function(e,t){this.vertexFragmentPrograms[e].onpost=t}},{key:"enableGraphic",value:function(e){this.vertexFragmentPrograms["0"|e.toString()].enabled=!0}},{key:"disableGraphic",value:function(e){this.vertexFragmentPrograms["0"|e.toString()].enabled=!1}},{key:"getVertexFragmentProgram",value:function(e){for(var t in this.vertexFragmentPrograms)if(t===e)return this.vertexFragmentPrograms[t];return null}},{key:"getAllVertexFragmentProgram",value:function(){return this.vertexFragmentPrograms}},{key:"processKernel",value:function(e,t,r){if(!0===e.enabled){if(void 0!==r&&null!==r&&!0===r&&(this.arrMakeCopy=[]),!0===e.depthTest?this._gl.enable(this._gl.DEPTH_TEST):this._gl.disable(this._gl.DEPTH_TEST),!0===e.blend?this._gl.enable(this._gl.BLEND):this._gl.disable(this._gl.BLEND),this._gl.blendFunc(this._gl[e.blendSrcMode],this._gl[e.blendDstMode]),this._gl.blendEquation(this._gl[e.blendEquation]),void 0!==e.onpre&&null!==e.onpre&&e.onpre(),void 0===t||null===t||!0===t){for(var i=!1,n=0;n<e.output.length;n++)if(null!=e.output[n]&&!0===e.outputTempModes[n]){i=!0;break}!0===i?(this._webCLGL.enqueueNDRangeKernel(e,o.WebCLGLUtils.getOutputBuffers(e,this._argsValues),!0,this._argsValues),this.arrMakeCopy.push(e)):this._webCLGL.enqueueNDRangeKernel(e,o.WebCLGLUtils.getOutputBuffers(e,this._argsValues),!1,this._argsValues)}else this._webCLGL.enqueueNDRangeKernel(e,o.WebCLGLUtils.getOutputBuffers(e,this._argsValues),!1,this._argsValues);void 0!==e.onpost&&null!==e.onpost&&e.onpost(),void 0!==r&&null!==r&&!0===r&&this.processCopies()}}},{key:"processCopies",value:function(e){for(var t=0;t<this.arrMakeCopy.length;t++)this._webCLGL.copy(this.arrMakeCopy[t],o.WebCLGLUtils.getOutputBuffers(this.arrMakeCopy[t],this._argsValues))}},{key:"processKernels",value:function(e){this.arrMakeCopy=[];for(var t in this.kernels)this.processKernel(this.kernels[t],e);this.processCopies()}},{key:"processGraphic",value:function(e){var t=[];for(var r in this.vertexFragmentPrograms){var i=this.vertexFragmentPrograms[r];if(!0===i.enabled){var n=void 0!==e&&null!==e||void 0===this.CLGL_bufferIndices||null===this.CLGL_bufferIndices?this._argsValues[e]:this.CLGL_bufferIndices;if(void 0!==n&&null!==n&&n.length>0){!0===i.depthTest?this._gl.enable(this._gl.DEPTH_TEST):this._gl.disable(this._gl.DEPTH_TEST),!0===i.blend?this._gl.enable(this._gl.BLEND):this._gl.disable(this._gl.BLEND),this._gl.blendFunc(this._gl[i.blendSrcMode],this._gl[i.blendDstMode]),this._gl.blendEquation(this._gl[i.blendEquation]),void 0!==i.onpre&&null!==i.onpre&&i.onpre();for(var l=!1,s=0;s<i.output.length;s++)if(null!=i.output[s]&&!0===i.outputTempModes[s]){l=!0;break}!0===l?(this._webCLGL.enqueueVertexFragmentProgram(i,n,i.drawMode,o.WebCLGLUtils.getOutputBuffers(i,this._argsValues),!0,this._argsValues),t.push(i)):this._webCLGL.enqueueVertexFragmentProgram(i,n,i.drawMode,o.WebCLGLUtils.getOutputBuffers(i,this._argsValues),!1,this._argsValues),void 0!==i.onpost&&null!==i.onpost&&i.onpost()}}}for(var a=0;a<t.length;a++)this._webCLGL.copy(t[a],o.WebCLGLUtils.getOutputBuffers(t[a],this._argsValues))}},{key:"ini",value:function(){var e=arguments[0],t=void 0,r=void 0,i=void 0;e.length>3?(this._args=e[0],t=e[1],r=e[2],i=e[3]):(this._args=e[0],t=e[1],r="FLOAT",i=e[2]);var n=0;for(var l in this._args){var s=this._args[l];this.setArg(l.split(" ")[1],s),0===n&&(s instanceof Array||s instanceof Float32Array||s instanceof Uint8Array||s instanceof HTMLImageElement)&&(n=s.length)}return"FLOAT"===r?this.addArg("float* result"):this.addArg("float4* result"),this.setArg("result",new Float32Array(n),null,r),this.addKernel({type:"KERNEL",name:"SIMPLE_KERNEL",viewSource:!1,config:[t,["result"],"",i]}),this.processKernels(),this._webCLGL.readBuffer(this._argsValues.result)}},{key:"iniG",value:function(){this._webCLGL.getContext().depthFunc(this._webCLGL.getContext().LEQUAL),this._webCLGL.getContext().clearDepth(1);var e=arguments[0];this._args=e[1];for(var t=2;t<e.length;t++)"KERNEL"===e[t].type?this.addKernel(e[t]):"GRAPHIC"===e[t].type&&this.addGraphic(e[t]);for(var r in this._args){var i=this._args[r];"indices"===r?null!==i&&this.setIndices(i):this.setArg(r.split(" ")[1],i)}}}]),e}();i.WebCLGLFor=u,t.exports.WebCLGLFor=u,i.gpufor=l,t.exports.gpufor=l}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"./WebCLGL.class":1,"./WebCLGLUtils.class":5}],4:[function(e,t,r){(function(i){"use strict";function n(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(r,"__esModule",{value:!0}),r.WebCLGLKernel=void 0;var l=function(){function e(e,t){for(var r=0;r<t.length;r++){var i=t[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,r,i){return r&&e(t.prototype,r),i&&e(t,i),t}}(),s=e("./WebCLGLUtils.class"),a=r.WebCLGLKernel=function(){function e(t,r,i){n(this,e),this._gl=t;var l=this._gl.getShaderPrecisionFormat(this._gl.FRAGMENT_SHADER,this._gl.HIGH_FLOAT);this._precision=0!==l.precision?"precision highp float;\n\nprecision highp int;\n\n":"precision lowp float;\n\nprecision lowp int;\n\n",this.version=this._gl instanceof WebGL2RenderingContext?"#version 300 es \n ":"",this._arrExt=this._gl instanceof WebGL2RenderingContext?{EXT_color_buffer_float:null}:{OES_texture_float:null,OES_texture_float_linear:null,OES_element_index_uint:null,WEBGL_draw_buffers:null};for(var s in this._arrExt)this._arrExt[s]=this._gl.getExtension(s),null==this._arrExt[s]?console.error("extension "+s+" not available"):console.log("using extension "+s);this.extDrawBuff=this._gl instanceof WebGL2RenderingContext?"":" #extension GL_EXT_draw_buffers : require\n",this.name="",this.enabled=!0,this.depthTest=null,this.blend=null,this.blendSrcMode=null,this.blendDstMode=null,this.blendEquation=null,this.onpre=null,this.onpost=null,this.viewSource=!1,this.in_values={},this.output=null,this.outputTempModes=null,this.fBuffer=null,this.fBufferTemp=null,this.fBufferLength=0,this.fBufferCount=0,void 0!==r&&null!==r&&this.setKernelSource(r,i)}return l(e,[{key:"setKernelSource",value:function(e,t){for(var r=this._gl instanceof WebGL2RenderingContext==!0?"in":"attribute",i=this._gl instanceof WebGL2RenderingContext==!0?"out":"varying",n=this._gl instanceof WebGL2RenderingContext==!0?"in":"varying",l=function(){var e=this.version+this._precision+r+" vec3 aVertexPosition;\n"+i+" vec2 global_id;\nvoid main(void) {\ngl_Position = vec4(aVertexPosition, 1.0);\nglobal_id = aVertexPosition.xy*0.5+0.5;\n}\n",t=this.version+this.extDrawBuff+this._precision+s.WebCLGLUtils.lines_fragment_attrs(this.in_values)+n+" vec2 global_id;\nuniform float uBufferWidth;vec2 get_global_id() {\nreturn global_id;\n}\n"+s.WebCLGLUtils.get_global_id3_GLSLFunctionString()+s.WebCLGLUtils.get_global_id2_GLSLFunctionString()+this._head+(this._gl instanceof WebGL2RenderingContext?s.WebCLGLUtils.lines_drawBuffersWriteInit_GL2(8):"")+"void main(void) {\n"+s.WebCLGLUtils.lines_drawBuffersInit(8)+this._source+(this._gl instanceof WebGL2RenderingContext?s.WebCLGLUtils.lines_drawBuffersWrite_GL2(8):s.WebCLGLUtils.lines_drawBuffersWrite(8))+"}\n";this.kernel=this._gl.createProgram();(new s.WebCLGLUtils).createShader(this._gl,"WEBCLGL",e,t,this.kernel);this.attr_VertexPos=this._gl.getAttribLocation(this.kernel,"aVertexPosition"),this.uBufferWidth=this._gl.getUniformLocation(this.kernel,"uBufferWidth");for(var l in this.in_values)this.in_values[l].location=[this._gl.getUniformLocation(this.kernel,this.in_values[l].varname)];return"VERTEX PROGRAM\n"+e+"\n FRAGMENT PROGRAM\n"+t}.bind(this),a=e.split(")")[0].split("(")[1].split(","),o=0,u=a.length;o<u;o++)if(null!==a[o].match(/\*/gm)){var f=a[o].split("*")[1].trim();s.WebCLGLUtils.checkArgNameInitialization(this.in_values,f),null!=a[o].match(/float4/gm)?this.in_values[f].type="float4_fromSampler":null!=a[o].match(/float/gm)&&(this.in_values[f].type="float_fromSampler")}else if(""!==a[o]){var h=a[o].split(" ")[1].trim();for(var _ in this.in_values)if(_.replace(/\[\d.*/,"")===h){h=_;break}s.WebCLGLUtils.checkArgNameInitialization(this.in_values,h),null!=a[o].match(/float4/gm)?this.in_values[h].type="float4":null!=a[o].match(/float/gm)?this.in_values[h].type="float":null!=a[o].match(/mat4/gm)&&(this.in_values[h].type="mat4")}this._head=void 0!==t&&null!==t?t:"",this._head=this._head.replace(/\r\n/gi,"").replace(/\r/gi,"").replace(/\n/gi,""),this._head=s.WebCLGLUtils.parseSource(this._head,this.in_values,this._gl instanceof WebGL2RenderingContext),this._source=e.replace(/\r\n/gi,"").replace(/\r/gi,"").replace(/\n/gi,""),this._source=this._source.replace(/^\w* \w*\([\w\s\*,]*\) {/gi,"").replace(/}(\s|\t)*$/gi,""),this._source=s.WebCLGLUtils.parseSource(this._source,this.in_values,this._gl instanceof WebGL2RenderingContext);for(var g in this.in_values){var c={float4_fromSampler:"SAMPLER",float_fromSampler:"SAMPLER",float:"UNIFORM",float4:"UNIFORM",mat4:"UNIFORM"}[this.in_values[g].type];this.in_values[g].varname=g.replace(/\[\d.*/,""),this.in_values[g].varnameC=g,this.in_values[g].expectedMode=c}var d=l();!0===this.viewSource&&(console.log("%c KERNEL: "+this.name,"font-size: 20px; color: blue"),console.log("%c WEBCLGL --------------------------------","color: gray"),console.log("%c "+t+e,"color: gray"),console.log("%c TRANSLATED WEBGL ------------------------------","color: darkgray"),console.log("%c "+d,"color: darkgray"))}}]),e}();i.WebCLGLKernel=a,t.exports.WebCLGLKernel=a}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"./WebCLGLUtils.class":5}],5:[function(e,t,r){(function(e){"use strict";function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(r,"__esModule",{value:!0});var n=function(){function e(e,t){for(var r=0;r<t.length;r++){var i=t[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,r,i){return r&&e(t.prototype,r),i&&e(t,i),t}}(),l=r.WebCLGLUtils=function(){function e(){i(this,e)}return n(e,[{key:"loadQuad",value:function(e,t,r){var i=void 0===t||null===t?.5:t,n=void 0===r||null===r?.5:r;this.vertexArray=[-i,-n,0,i,-n,0,i,n,0,-i,n,0],this.textureArray=[0,0,0,1,0,0,1,1,0,0,1,0],this.indexArray=[0,1,2,0,2,3];var l={};return l.vertexArray=this.vertexArray,l.textureArray=this.textureArray,l.indexArray=this.indexArray,l}},{key:"createShader",value:function(e,t,r,i,n){var l=!1,s=!1,a=function(t,r){console.log(t);for(var i=[],n=t.split("\n"),l=0,s=n.length;l<s;l++)if(null!=n[l].match(/^ERROR/gim)){var a=n[l].split(":"),o=parseInt(a[2]);i.push([o,n[l]])}var u=e.getShaderSource(r).split("\n");u.unshift("");for(var f=0,h=u.length;f<h;f++){for(var _=!1,g="",c=0,d=i.length;c<d;c++)if(f===i[c][0]){_=!0,g=i[c][1];break}!1===_?console.log("%c"+f+" %c"+u[f],"color:black","color:blue"):console.log("%c►►%c"+f+" %c"+u[f]+"\n%c"+g,"color:red","color:black","color:blue","color:red")}}.bind(this),o=e.createShader(e.VERTEX_SHADER);if(e.shaderSource(o,r),e.compileShader(o),e.getShaderParameter(o,e.COMPILE_STATUS))e.attachShader(n,o),l=!0;else{var u=e.getShaderInfoLog(o);console.log("%c"+t+" ERROR (vertex program)","color:red"),void 0!==u&&null!==u&&a(u,o)}var f=e.createShader(e.FRAGMENT_SHADER);if(e.shaderSource(f,i),e.compileShader(f),e.getShaderParameter(f,e.COMPILE_STATUS))e.attachShader(n,f),s=!0;else{var h=e.getShaderInfoLog(f);console.log("%c"+t+" ERROR (fragment program)","color:red"),void 0!==h&&null!==h&&a(h,f)}if(!0===l&&!0===s){if(e.linkProgram(n),e.getProgramParameter(n,e.LINK_STATUS))return!0;console.log("Error shader program "+t+":\n ");var _=e.getProgramInfoLog(n);return void 0!==_&&null!==_&&console.log(_),!1}return!1}},{key:"pack",value:function(e){var t=[1/255,1/255,1/255,0],r=e,i=this.fract(255*r),n=this.fract(255*i),l=[r,i,n,this.fract(255*n)],s=[l[1]*t[0],l[2]*t[1],l[3]*t[2],l[3]*t[3]];return[l[0]-s[0],l[1]-s[1],l[2]-s[2],l[3]-s[3]]}},{key:"unpack",value:function(e){var t=[1,1/255,1/65025,1/16581375];return this.dot4(e,t)}}],[{key:"getWebGLContextFromCanvas",value:function(e,t){var r=null;try{r=void 0===t||null===t?e.getContext("webgl2"):e.getContext("webgl2",t),console.log(null==r?"no webgl2":"using webgl2")}catch(e){r=null}if(null==r)try{r=void 0===t||null===t?e.getContext("experimental-webgl2"):e.getContext("experimental-webgl2",t),console.log(null==r?"no experimental-webgl2":"using experimental-webgl2")}catch(e){r=null}if(null==r)try{r=void 0===t||null===t?e.getContext("webgl"):e.getContext("webgl",t),console.log(null==r?"no webgl":"using webgl")}catch(e){r=null}if(null==r)try{r=void 0===t||null===t?e.getContext("experimental-webgl"):e.getContext("experimental-webgl",t),console.log(null==r?"no experimental-webgl":"using experimental-webgl")}catch(e){r=null}return null==r&&(r=!1),r}},{key:"getUint8ArrayFromHTMLImageElement",value:function(e){var t=document.createElement("canvas");t.width=e.width,t.height=e.height;var r=t.getContext("2d");return r.drawImage(e,0,0),r.getImageData(0,0,e.width,e.height).data}},{key:"dot4",value:function(e,t){return e[0]*t[0]+e[1]*t[1]+e[2]*t[2]+e[3]*t[3]}},{key:"fract",value:function(e){return e>0?e-Math.floor(e):e-Math.ceil(e)}},{key:"packGLSLFunctionString",value:function(){return"vec4 pack (float depth) {\nconst vec4 bias = vec4(1.0 / 255.0,\n1.0 / 255.0,\n1.0 / 255.0,\n0.0);\nfloat r = depth;\nfloat g = fract(r * 255.0);\nfloat b = fract(g * 255.0);\nfloat a = fract(b * 255.0);\nvec4 colour = vec4(r, g, b, a);\nreturn colour - (colour.yzww * bias);\n}\n"}},{key:"unpackGLSLFunctionString",value:function(){return"float unpack (vec4 colour) {\nconst vec4 bitShifts = vec4(1.0,\n1.0 / 255.0,\n1.0 / (255.0 * 255.0),\n1.0 / (255.0 * 255.0 * 255.0));\nreturn dot(colour, bitShifts);\n}\n"}},{key:"getOutputBuffers",value:function(e,t){var r=null;if(void 0!==e.output&&null!==e.output)if(r=[],null!=e.output[0])for(var i=0;i<e.output.length;i++)r[i]=t[e.output[i]];else r=null;return r}},{key:"parseSource",value:function(e,t,r){var i=!0===r?"texture":"texture2D";for(var n in t){var l=new RegExp(n+"\\[(?!\\d).*?\\]","gm"),s=e.match(l);if(null!=s)for(var a=0,o=s.length;a<o;a++){var u=new RegExp("```(s|\t)*gl.*"+s[a]+".*```[^```(s|\t)*gl]","gm");if(null==e.match(u)){var f=s[a].split("[")[0],h=s[a].split("[")[1].split("]")[0];e={float4_fromSampler:e.replace(f+"["+h+"]",i+"("+f+","+h+")"),float_fromSampler:e.replace(f+"["+h+"]",i+"("+f+","+h+").x"),float4_fromAttr:e.replace(f+"["+h+"]",f),float_fromAttr:e.replace(f+"["+h+"]",f)}[t[n].type]}}}return e=e.replace(/```(\s|\t)*gl/gi,"").replace(/```/gi,"").replace(/;/gi,";\n").replace(/}/gi,"}\n").replace(/{/gi,"{\n")}},{key:"lines_vertex_attrs",value:function(e,t){var r=!0===t?"in":"attribute",i="";for(var n in e)i+={float4_fromSampler:"uniform sampler2D "+n+";",float_fromSampler:"uniform sampler2D "+n+";",float4_fromAttr:r+" vec4 "+n+";",float_fromAttr:r+" float "+n+";",float:"uniform float "+n+";",float4:"uniform vec4 "+n+";",mat4:"uniform mat4 "+n+";"}[e[n].type]+"\n";return i}},{key:"lines_fragment_attrs",value:function(e){var t="";for(var r in e)t+={float4_fromSampler:"uniform sampler2D "+r+";",float_fromSampler:"uniform sampler2D "+r+";",float:"uniform float "+r+";",float4:"uniform vec4 "+r+";",mat4:"uniform mat4 "+r+";"}[e[r].type]+"\n";return t}},{key:"lines_drawBuffersInit",value:function(e){for(var t="",r=0,i=e;r<i;r++)t+="float out"+r+"_float = -999.99989;\nvec4 out"+r+"_float4;\n";return t}},{key:"lines_drawBuffersWriteInit_GL2",value:function(e){for(var t="",r=0,i=e;r<i;r++)t+="layout(location = "+r+") out vec4 outCol"+r+";\n";return t}},{key:"lines_drawBuffersWrite_GL2",value:function(e){for(var t="",r=0,i=e;r<i;r++)t+="if(out"+r+"_float != -999.99989) outCol"+r+" = vec4(out"+r+"_float,0.0,0.0,1.0);\n else outCol"+r+" = out"+r+"_float4;\n";return t}},{key:"lines_drawBuffersWrite",value:function(e){for(var t="",r=0,i=e;r<i;r++)t+="if(out"+r+"_float != -999.99989) gl_FragData["+r+"] = vec4(out"+r+"_float,0.0,0.0,1.0);\n else gl_FragData["+r+"] = out"+r+"_float4;\n";return t}},{key:"checkArgNameInitialization",value:function(e,t){!1===e.hasOwnProperty(t)&&(e[t]={varname:null,type:null,expectedMode:null,location:null})}},{key:"get_global_id3_GLSLFunctionString",value:function(){return"vec2 get_global_id(float id, float bufferWidth, float geometryLength) {\nfloat texelSize = 1.0/bufferWidth;float num = (id*geometryLength)/bufferWidth;float column = fract(num)+(texelSize/2.0);float row = (floor(num)/bufferWidth)+(texelSize/2.0);return vec2(column, row);}\n"}},{key:"get_global_id2_GLSLFunctionString",value:function(){return"vec2 get_global_id(vec2 id, float bufferWidth) {\nfloat texelSize = 1.0/bufferWidth;float column = (id.x/bufferWidth)+(texelSize/2.0);float row = (id.y/bufferWidth)+(texelSize/2.0);return vec2(column, row);}\n"}}]),e}();e.WebCLGLUtils=l,t.exports.WebCLGLUtils=l}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],6:[function(e,t,r){(function(i){"use strict";function n(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(r,"__esModule",{value:!0}),r.WebCLGLVertexFragmentProgram=void 0;var l=function(){function e(e,t){for(var r=0;r<t.length;r++){var i=t[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,r,i){return r&&e(t.prototype,r),i&&e(t,i),t}}(),s=e("./WebCLGLUtils.class"),a=r.WebCLGLVertexFragmentProgram=function(){function e(t,r,i,l,s){n(this,e),this._gl=t;var a=this._gl.getShaderPrecisionFormat(this._gl.FRAGMENT_SHADER,this._gl.HIGH_FLOAT);this._precision=0!==a.precision?"precision highp float;\n\nprecision highp int;\n\n":"precision lowp float;\n\nprecision lowp int;\n\n",this.version=this._gl instanceof WebGL2RenderingContext?"#version 300 es \n ":"",this._arrExt=this._gl instanceof WebGL2RenderingContext?{EXT_color_buffer_float:null}:{OES_texture_float:null,OES_texture_float_linear:null,OES_element_index_uint:null,WEBGL_draw_buffers:null};for(var o in this._arrExt)this._arrExt[o]=this._gl.getExtension(o),null==this._arrExt[o]?console.error("extension "+o+" not available"):console.log("using extension "+o);this.extDrawBuff=this._gl instanceof WebGL2RenderingContext?"":" #extension GL_EXT_draw_buffers : require\n",this.name="",this.viewSource=!1,this.in_vertex_values={},this.in_fragment_values={},this._vertexP_ready=!1,this._fragmentP_ready=!1,this._vertexHead=null,this._vertexSource=null,this._fragmentHead=null,this._fragmentSource=null,this.output=null,this.outputTempModes=null,this.fBuffer=null,this.fBufferTemp=null,this.drawMode=4,void 0!==r&&null!==r&&this.setVertexSource(r,i),void 0!==l&&null!==l&&this.setFragmentSource(l,s)}return l(e,[{key:"compileVertexFragmentSource",value:function(){var e=this.version+this._precision+"uniform float uOffset;\nuniform float uBufferWidth;"+s.WebCLGLUtils.lines_vertex_attrs(this.in_vertex_values,this._gl instanceof WebGL2RenderingContext)+s.WebCLGLUtils.unpackGLSLFunctionString()+s.WebCLGLUtils.get_global_id3_GLSLFunctionString()+s.WebCLGLUtils.get_global_id2_GLSLFunctionString()+this._vertexHead+"void main(void) {\n"+this._vertexSource+"}\n",t=this.version+this.extDrawBuff+this._precision+s.WebCLGLUtils.lines_fragment_attrs(this.in_fragment_values)+s.WebCLGLUtils.get_global_id3_GLSLFunctionString()+s.WebCLGLUtils.get_global_id2_GLSLFunctionString()+this._fragmentHead+(this._gl instanceof WebGL2RenderingContext?s.WebCLGLUtils.lines_drawBuffersWriteInit_GL2(8):"")+"void main(void) {\n"+s.WebCLGLUtils.lines_drawBuffersInit(8)+this._fragmentSource+(this._gl instanceof WebGL2RenderingContext?s.WebCLGLUtils.lines_drawBuffersWrite_GL2(8):s.WebCLGLUtils.lines_drawBuffersWrite(8))+"}\n";this.vertexFragmentProgram=this._gl.createProgram();(new s.WebCLGLUtils).createShader(this._gl,"WEBCLGL VERTEX FRAGMENT PROGRAM",e,t,this.vertexFragmentProgram);this.uOffset=this._gl.getUniformLocation(this.vertexFragmentProgram,"uOffset"),this.uBufferWidth=this._gl.getUniformLocation(this.vertexFragmentProgram,"uBufferWidth");for(var r in this.in_vertex_values){var i="ATTRIBUTE"===this.in_vertex_values[r].expectedMode?this._gl.getAttribLocation(this.vertexFragmentProgram,this.in_vertex_values[r].varname):this._gl.getUniformLocation(this.vertexFragmentProgram,this.in_vertex_values[r].varname);this.in_vertex_values[r].location=[i]}for(var n in this.in_fragment_values)this.in_fragment_values[n].location=[this._gl.getUniformLocation(this.vertexFragmentProgram,this.in_fragment_values[n].varname)];return"VERTEX PROGRAM\n"+e+"\n FRAGMENT PROGRAM\n"+t}},{key:"setVertexSource",value:function(e,t){for(var r=e.split(")")[0].split("(")[1].split(","),i=0,n=r.length;i<n;i++)if(null!==r[i].match(/\*attr/gm)){var l=r[i].split("*attr")[1].trim();s.WebCLGLUtils.checkArgNameInitialization(this.in_vertex_values,l),null!=r[i].match(/float4/gm)?this.in_vertex_values[l].type="float4_fromAttr":null!=r[i].match(/float/gm)&&(this.in_vertex_values[l].type="float_fromAttr")}else if(null!==r[i].match(/\*/gm)){var a=r[i].split("*")[1].trim();s.WebCLGLUtils.checkArgNameInitialization(this.in_vertex_values,a),null!=r[i].match(/float4/gm)?this.in_vertex_values[a].type="float4_fromSampler":null!=r[i].match(/float/gm)&&(this.in_vertex_values[a].type="float_fromSampler")}else if(""!==r[i]){var o=r[i].split(" ")[1].trim();for(var u in this.in_vertex_values)if(u.replace(/\[\d.*/,"")===o){o=u;break}s.WebCLGLUtils.checkArgNameInitialization(this.in_vertex_values,o),null!=r[i].match(/float4/gm)?this.in_vertex_values[o].type="float4":null!=r[i].match(/float/gm)?this.in_vertex_values[o].type="float":null!=r[i].match(/mat4/gm)&&(this.in_vertex_values[o].type="mat4")}this._vertexHead=void 0!==t&&null!==t?t:"",this._vertexHead=this._vertexHead.replace(/\r\n/gi,"").replace(/\r/gi,"").replace(/\n/gi,""),this._vertexHead=s.WebCLGLUtils.parseSource(this._vertexHead,this.in_vertex_values,this._gl instanceof WebGL2RenderingContext),this._vertexSource=e.replace(/\r\n/gi,"").replace(/\r/gi,"").replace(/\n/gi,""),this._vertexSource=this._vertexSource.replace(/^\w* \w*\([\w\s\*,]*\) {/gi,"").replace(/}(\s|\t)*$/gi,""),this._vertexSource=s.WebCLGLUtils.parseSource(this._vertexSource,this.in_vertex_values,this._gl instanceof WebGL2RenderingContext);for(var f in this.in_vertex_values){var h={float4_fromSampler:"SAMPLER",float_fromSampler:"SAMPLER",float4_fromAttr:"ATTRIBUTE",float_fromAttr:"ATTRIBUTE",float:"UNIFORM",float4:"UNIFORM",mat4:"UNIFORM"}[this.in_vertex_values[f].type];this.in_vertex_values[f].varname="ATTRIBUTE"===h?f:f.replace(/\[\d.*/,""),this.in_vertex_values[f].varnameC=f,this.in_vertex_values[f].expectedMode=h}if(this._vertexP_ready=!0,!0===this._fragmentP_ready){var _=this.compileVertexFragmentSource();!0===this.viewSource&&(console.log("%c VFP: "+this.name,"font-size: 20px; color: green"),console.log("%c WEBCLGL --------------------------------","color: gray"),console.log("%c "+t+e,"color: gray"),console.log("%c TRANSLATED WEBGL ------------------------------","color: darkgray"),console.log("%c "+_,"color: darkgray"))}}},{key:"setFragmentSource",value:function(e,t){for(var r=e.split(")")[0].split("(")[1].split(","),i=0,n=r.length;i<n;i++)if(null!==r[i].match(/\*/gm)){var l=r[i].split("*")[1].trim();s.WebCLGLUtils.checkArgNameInitialization(this.in_fragment_values,l),null!=r[i].match(/float4/gm)?this.in_fragment_values[l].type="float4_fromSampler":null!=r[i].match(/float/gm)&&(this.in_fragment_values[l].type="float_fromSampler")}else if(""!==r[i]){var a=r[i].split(" ")[1].trim();for(var o in this.in_fragment_values)if(o.replace(/\[\d.*/,"")===a){a=o;break}s.WebCLGLUtils.checkArgNameInitialization(this.in_fragment_values,a),null!=r[i].match(/float4/gm)?this.in_fragment_values[a].type="float4":null!=r[i].match(/float/gm)?this.in_fragment_values[a].type="float":null!=r[i].match(/mat4/gm)&&(this.in_fragment_values[a].type="mat4")}this._fragmentHead=void 0!==t&&null!==t?t:"",this._fragmentHead=this._fragmentHead.replace(/\r\n/gi,"").replace(/\r/gi,"").replace(/\n/gi,""),this._fragmentHead=s.WebCLGLUtils.parseSource(this._fragmentHead,this.in_fragment_values,this._gl instanceof WebGL2RenderingContext),this._fragmentSource=e.replace(/\r\n/gi,"").replace(/\r/gi,"").replace(/\n/gi,""),this._fragmentSource=this._fragmentSource.replace(/^\w* \w*\([\w\s\*,]*\) {/gi,"").replace(/}(\s|\t)*$/gi,""),this._fragmentSource=s.WebCLGLUtils.parseSource(this._fragmentSource,this.in_fragment_values,this._gl instanceof WebGL2RenderingContext);for(var u in this.in_fragment_values){var f={float4_fromSampler:"SAMPLER",float_fromSampler:"SAMPLER",float:"UNIFORM",float4:"UNIFORM",mat4:"UNIFORM"}[this.in_fragment_values[u].type];this.in_fragment_values[u].varname=u.replace(/\[\d.*/,""),this.in_fragment_values[u].varnameC=u,this.in_fragment_values[u].expectedMode=f}if(this._fragmentP_ready=!0,!0===this._vertexP_ready){var h=this.compileVertexFragmentSource();!0===this.viewSource&&(console.log("%c VFP: ","font-size: 20px; color: green"),console.log("%c WEBCLGL --------------------------------","color: gray"),console.log("%c "+t+e,"color: gray"),console.log("%c TRANSLATED WEBGL ------------------------------","color: darkgray"),console.log("%c "+h,"color: darkgray"))}}}]),e}();i.WebCLGLVertexFragmentProgram=a,t.exports.WebCLGLVertexFragmentProgram=a}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"./WebCLGLUtils.class":5}],7:[function(e,t,r){(function(r){"use strict";e("./WebCLGL.class"),e("./WebCLGLBuffer.class"),e("./WebCLGLFor.class"),e("./WebCLGLKernel.class"),e("./WebCLGLUtils.class"),e("./WebCLGLVertexFragmentProgram.class"),t.exports.WebCLGL=r.WebCLGL=WebCLGL,t.exports.WebCLGLBuffer=r.WebCLGLBuffer=WebCLGLBuffer,t.exports.WebCLGLFor=r.WebCLGLFor=WebCLGLFor,t.exports.WebCLGLKernel=r.WebCLGLKernel=WebCLGLKernel,t.exports.WebCLGLUtils=r.WebCLGLUtils=WebCLGLUtils,t.exports.WebCLGLVertexFragmentProgram=r.WebCLGLVertexFragmentProgram=WebCLGLVertexFragmentProgram}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"./WebCLGL.class":1,"./WebCLGLBuffer.class":2,"./WebCLGLFor.class":3,"./WebCLGLKernel.class":4,"./WebCLGLUtils.class":5,"./WebCLGLVertexFragmentProgram.class":6}]},{},[7]);